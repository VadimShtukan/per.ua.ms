# Architecture

## Services Decomposition 

Декомпозизая сервисов была произведена на основе пользовательского сценария - https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/use_case/create_order.md. В результате были выделены следующие сервисы:
- Сервис пользователей (User service):
    - Информация о пользователях.
    - Генерация токенов для пользователей.
    - Аутентификация пользователей.
    - Привязка пользователей к группам.
    - Вернуть UserId по номеру телефона. 
- Сервис товаров (Product service):
    - Описание и характеристики товаров, изображение.
    - Товарные остатки.
    - Вычисление стоимости товаров от базовой цены (в зависимости от курса доллара)
- Сервис заказов(Order service):
    - Информация о заказе, товары в заказе, общая сумма заказа.
    - Информация о доставке заказе.
    - Статусы заказов.
    - История изменения заказов.
    - напоминание пользователей о неоплаченных заказах. Автоматическая отмена неоплаченных заказов. 
- Сервис корзины (Cart Service):
    - Подсчет суммы заказа в корзине.
    - Хранение корзин покупателей.
    - Анализ не закрытых корзин и информирование об этом покупателей.
- Сервис для отправки уведомлений - почта, СМС, Telegram, Viber (Notification service).
    - Формирование текста уведомления.
    - Принятие решения по способу доставки сообщений.
    - Контроль доставки сообщений.
- Сервис скидок (Discount Service):
    - Подсчет скидки для покупателя.
    - Начисление/списание скидок.
- Сервис оплат (Payment Service)
    - взаимодействие с провайдерами приема оплат.
    - контроль оплат и Информирование Order сервиса об успешной оплате.
    
    
- чеки фискальные
- чеки не фискальные
- Новая почта
- РРО и х-отчет
- напоминание о незабранных посылках
- создание деклараций для магазинов
## Общая схема


## Межсервисное взаимодействие (синхронное, асинхронное)
- EventDriven

## Диграмма состояния (кафка)

## Кеширование

## Защита от двойной отправки сообщений

## Метрики
- Ошибки
- Скорость
- Бизнес метрики

## Мониторинг, алертинг и  логирование



 
