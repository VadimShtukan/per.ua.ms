## Создание заказа покупателем или менеджером ИМ
Покупатель заходит на сайт ИМ и находит товар(через поиск или каталог), который он хочет заказать.  
![Image description](https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/img/product.jpg)   
Покупатель выбирает нужный ему размер и нажимает на кнопку "Оформить заказ". Если покупатель не выбрал размер, то заказ создается без указания размера. После нажатия покупателем кнопки "Оформить заказ", товар добавляется в корзину и покупатель переходит в корзину.  

Информация, которая должна отображаться в корзине:  
- Кнопка "продолжить покупку", при нажатии на которую, идет переход на предыдущую страницу.
- Предложение войти или зарегистрироваться. Не обязательно - если покупатель будет не аутентифицирован, то бэкенд должен сделать это автоматически по номеру телефона.
- Информация о заказе. Здесь покупатель должен иметь возможность - поменять, добавить или удалить размер; удалить позицию из заказа. Если пользователь аутентифицирован, то необходимо добавить его скидку, если она у него есть.
- Информация о доставке. Покупатель может/должен заполнить следующие поля
    - ФИО. Обязательно,
    - номер телефона в формате +. Обязательное,
    - способ оплаты. Необязательно,
    - способ доставки. Необязательно,
- Комментарии к заказу.
- электронная почта.
- Кнопка "Подтверждаю заказ".

Если Покупатель аутентифицирован, то все поля должны быть заполнены автомитически, взятые из регистрационных данных и из предыдущего заказа.  

![Image description](https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/img/cart.jpg)  
Покупатель делает необходимые изменения в информации о заказе - удаляет ненужные позиции, меняет размеры и т.д.  

Покупатель выбирает способ оплаты. Для покупателя доступны следующи способы оплаты. Набор оплат зависит от способа доставки:
- При получении.
- На карту.
- Кредитной картой Visa/MasterCard.  

Покупатель заполняет информацию о доставке. У каждого способа доставки должны быть свои поля для заполнения. Для покупателя доступны следующие варианты способов доставки:
- Новая почта(на склад). Поля для заполнения:
    - город (выпадающий список),
    - номер склада (выпадающий список),
    - доступные способы оплаты: Все.
- Новая почта (на адрес). Поля для заполнения:
    - город (выпадающий список),
    - улица (выпадающий список),
    - номер дома (выпадающий список),
    - номер квартиры,
    - доступные способы оплаты: На карту; Кредитной картой Visa/MasterCard.
- Почтой. Поля для заполнения:
    - индекс,
    - страна,
    - город,
    - улица,
    - номер дома,
    - номер квартиры,
    - доступные способы оплаты: Кредитной картой Visa/MasterCard.
- Самовывоз. Поля для заполнения:
    - Город (выпадающий список),
    - доступные способы оплаты: При получении.  

После заполнения полей покупатель нажимает на кнопку "Подтверждаю заказ". При этом Фроненд, перед отправкой данных на Бэкенд, должен проверить правильность заполнения обязательных полей - указан номер телефона в формате +, и указано ФИО (хотя бы имя).   

Если все поля оформлены верно Фронтенд отправляет запрос на Бэкэнда. 

Если запрос пришел от неаутентифицированного покупателя, то Бэкенд производит автоматическую аутентификацию/регистрацию покупателя по номеру телефону, согласно процессу и use case - Регистрация и аутентификация покупателя.  Т.е. все заказы должны быть оформлены от зарегистрированных покупателей.

Бэкенд проверяет заказ на ошибки. Алгоритм проверки на ошибки:  
- Номер телефона указан в формате +, нет лишних символов и т.п..
- Указано хотя бы имя в ФИО.
- Если указана оплата Кредитной картой Visa/Mastercard: 
    - В заказе указаны все размеры.
    - Заказанный товар есть в наличии.
    - Указана электронная почта.
    - Указана страна и у нас есть возможность отправки в эту страну без дополнительного подтверждения менеджером.  

Если ошибок нет:
- Бэкэнд создает заказ со статусом "Ожидается подтверждение", 
- Оповещает менеджера(на почту) о том, что есть новый заказа, который нужно обработать,
- Отправляет письмо покупателю, о том, что его заказ оформлен и ожидает подтверждение. 
- Если указана оплата Кредитной картой Visa/Mastercard и нет ошибок, то статус заказа меняется на "Ожидается оплата" и Покупателю(на почту или др. коммуникации) отправляется ссылка для оплаты.  

Если ошибок нет, то Бэкенд возвращает Фронтенду информация о заказе (со ссылкой на оплату, если есть). Фронтенд отображает эту информацию Покупателю, корзина покупателя очищается.  

Если есть ссылка на оплату заказа, Покупатель переходит на нее и оплачивает заказ. После подтверждения оплаты, Бэкенд должен поменять статус заказа на "Ожидается отправка".  

Менеджер ИМ, при получении информации о появлении нового заказа со статусом "Ожидается подтверждение", связывается с клиентом, уточняет всю информацию, изменяет заказ при необходимости, и переводит заказ в соответсвующий статус, в зависимости от формы оплаты и способа доставки: "Ожидается оплата" или "Ожидается отправка(оплата при получении)".  

Бухгалтер, при получении оплаты, меняет статус заказа на "Ожидается отправка". Оплата оформляется через РРО (для налоговой) с автоматической отправкой ежедневного X-отчета.  

Кладовщик, при появлении заказов со статусом "Ожидается отправка" или "Ожидается отправка(оплата при получении)" создает декларацию, упаковывает посылку, и меняет статус на "Заказ отправлен".  

Об изменении статуса заказа Покупатель информируется по средства электронной почты или др. коммуникаций (viber, СМС).  

Процесс создания заказа менеджером ИМ (н.п. нсли клиент сам позвонил для оформления заказа) ни как не отличается от процесса создания заказа покупателем, за исключением того, что менеджер всегда должен делать заказы от НЕзарегистрированного покупатель. Таким образом заказы всегда будут создаваться от имени покупателя, идентифицированные по номеру телефона по номеру телефона. 

## Диаграммы состояний
![Image description](https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/img/create_order_1.png)  
![Image description](https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/img/create_order_2.png)  
![Image description](https://github.com/VadimShtukan/per.ua.ms/blob/master/documentation/img/create_order_3.png)  